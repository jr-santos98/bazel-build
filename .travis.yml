os: linux
arch: ppc64le
sudo: required
language: go
go:
- "1.13.x"

jobs:
  include:
    - dist: xenial
      env: dist_version=16.04
    - dist: bionic
      env: dist_version=18.04

install:
  - sudo apt update
  - sudo apt install build-essential python zip unzip gcc
  - sudo apt install default-jre default-jdk

script:
  - wget -q https://oplab9.parqtec.unicamp.br/pub/ppc64el/bazel/ubuntu_${dist_version}/bazel_bin_ppc64le_2.0.0
  - sudo mv bazel_bin_ppc64le_2.0.0 /usr/local/bin/bazel
  - sudo chmod +x /usr/local/bin/bazel
  - git clone --depth 1 https://github.com/bazelbuild/bazel.git
  #- git clone https://github.com/bazelbuild/bazel.git
  - rm bazel/src/main/java/com/google/devtools/build/lib/syntax/BUILD 
  - mv BUILD bazel/src/main/java/com/google/devtools/build/lib/syntax/
  - cd bazel
  #- git checkout 8ae9f75d6daee8409a11bd50070be42739107db3
  - bazel --nomaster_bazelrc --bazelrc=/dev/null version
  - bazel --nomaster_bazelrc --bazelrc=/dev/null info
  - bazel build --host_javabase=@local_jdk//:jdk -- //src:bazel //src:bazel_jdk_minimal //src:test_repos
